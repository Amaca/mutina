{"version":3,"names":[],"mappings":"","sources":["src/app/app.js"],"sourcesContent":["/* jshint esversion: 6 */\n/* global window, document, Swiper, TweenMax, TimelineMax */\n\nimport \"@babel/polyfill\";\nimport barba from '@barba/core';\nimport cssVars from 'css-vars-ponyfill';\nimport Anchors from './shared/anchors';\nimport Appears from './shared/appears';\nimport CustomSelect from './shared/custom.select';\nimport Dom from './shared/dom';\nimport Fancy from './shared/fancy';\nimport FancyDetail from './shared/fancy.detail';\nimport FancyViewAll from \"./shared/fancy.view-all\";\nimport Filters from './shared/filters';\nimport Follower from './shared/follower';\nimport Forms from './shared/forms';\nimport Grid from './shared/grid';\nimport LazyLoad from './shared/lazyload';\nimport Navigation from \"./shared/navigation\";\nimport Rect from './shared/rect';\nimport Samples from './shared/samples';\nimport ScrollAnchors from \"./shared/scroll.anchors\";\nimport SidePanel from './shared/side.panel';\nimport Sliders from './shared/sliders';\nimport Tabs from './shared/tabs';\nimport ToggleSearch from './shared/toggle.search';\nimport Utils from './shared/utils';\nimport Wishlist from './shared/wishlist';\n\nconst debug = false;\nconst barbaDebug = debug;\n\nwindow.debug__ = (...args) => {\n    if (debug) {\n        console.log(...args);\n    }\n};\nwindow.log__ = (...args) => {\n    console.log(...args);\n};\nwindow.error__ = (...args) => {\n    console.error(...args);\n};\n\n// settings\nlet scrollSpeed = 8;\nconst activateIntro = false;\nlet disableBarba = false;\nconst breakTransition = false;\nlet smoothScroll = true;\nconst disableRender = false;\n\nlet firstLoad = false;\nlet scrollPosition = '';\n\nconst userAgent = navigator.userAgent.toLowerCase();\nconst isIE11 = !!window.MSInputMethodContext && !!document.documentMode;\n\nexport default class App {\n\n    constructor() {}\n\n    init() {\n        if (isIE11) {\n            this.polyfill();\n            cssVars();\n            document.querySelector('body').classList.add('ie11');\n        }\n        log__('%c Coded by Websolute ', 'background: #01c0f6; color: #fff; border-radius: 20px; padding: 10px;');\n        const body = document.querySelector('body');\n        const page = document.querySelector('.page');\n        const header = document.querySelector('.header');\n        const smooth = 'cubic-bezier(0, 0.97, 0.43, 1)';\n\n        const follower = new Follower(document.querySelector('.follower'));\n        const hrefs = [].slice.call(document.querySelectorAll('[href=\"#\"]'));\n        const links = [].slice.call(document.querySelectorAll('.btn'));\n\n        Dom.detect(body);\n        const mouse = {\n            x: 0,\n            y: 0\n        };\n        if (follower.enabled) {\n            body.classList.add('follower-enabled');\n        }\n        this.body = body;\n        this.page = page;\n        this.header = header;\n        this.smooth = smooth;\n        this.appears = [];\n        this.parallaxes = [];\n        this.follower = follower;\n        this.hrefs = hrefs;\n        this.links = links;\n        this.mouse = mouse;\n        this.onResize();\n        this.addListeners();\n        this.transitions();\n\n        Element.prototype.scrollIntoView_ = Element.prototype.scrollIntoView;\n        Element.prototype.scrollIntoView = function () {\n            if (Dom.fastscroll) {\n                return this.scrollIntoView_.apply(this, arguments);\n            } else {\n                let rect = Rect.fromNode(this);\n                const scrollTop = Dom.scrollTop();\n                window.scrollTo(0, Math.max(0, scrollTop + rect.top - 120));\n            }\n        };\n        firstLoad = true;\n        Navigation.init();\n        CustomSelect.init();\n        body.classList.add('ready');\n\n        if ('scrollRestoration' in history) {\n            history.scrollRestoration = 'manual';\n        }\n\n        if (this.body.classList.contains('safari')) {\n            smoothScroll = false;\n        }\n\n        if (!smoothScroll) {\n            Dom.fastscroll = true;\n            this.body.classList.add('fastscroll');\n        }\n    }\n\n    static initScript(data) {\n        var parser = new DOMParser();\n        var doc = parser.parseFromString(data.next.html, \"text/html\");\n\n        var scripts = doc.querySelectorAll('script[data-products]');\n        if (scripts) {\n            scripts.forEach(function (x) {\n                window.eval(x.innerHTML);\n            });\n        }\n    }\n\n    animateTransitionLine(done) {\n        const line = document.querySelector('.transition__line');\n        const boxBack = document.querySelector('.transition__text .box--back');\n        let perfData = window.performance.timing,\n            EstimatedTime = -(perfData.loadEventEnd - perfData.navigationStart),\n            time = parseInt((EstimatedTime / 1000) % 60) * 100,\n            start = 0,\n            end = 100,\n            duration = time;\n        let range = end - start,\n            current = start,\n            increment = end > start ? 1 : -1,\n            stepTime = Math.abs(Math.floor(duration / range));\n        let timer = setInterval(function () {\n            current += increment;\n            TweenMax.to(line, time, {\n                width: current + '%',\n                ease: Expo.easeInOut,\n            });\n            TweenMax.to(boxBack, time, {\n                width: current + '%',\n                ease: Expo.easeInOut,\n            });\n            //debug__('current', current);\n            if (current == end) {\n                clearInterval(timer);\n                done();\n            }\n        }, stepTime);\n    }\n\n    transitions() {\n        const transitionLayer = document.querySelector('.transition');\n        const textFront = document.querySelector('.transition__text .box--front .text');\n        const textBack = document.querySelector('.transition__text .box--back .text');\n        const boxBack = document.querySelector('.transition__text .box--back');\n        const line = document.querySelector('.transition__line');\n        const page = this.page;\n\n        if (!disableBarba) {\n            barba.init({\n                cacheIgnore: true,\n                prefetchIgnore: true,\n                timeout: 20000,\n                debug: barbaDebug,\n                transitions: [{\n                        name: 'default',\n                        appear(data) {\n                            const done = this.async();\n                            try {\n                                const transitionLayer = document.querySelector('.transition');\n                                const logoWrapper = document.querySelector('.transition .logo__wrapper');\n                                if (activateIntro) {\n                                    let tl = new TimelineMax();\n                                    const speed = 0.5;\n                                    const transform = -10;\n                                    tl.timeScale(0.9);\n                                    const logo = [{\n                                            name: 'charM',\n                                            selector: document.querySelector('.logo__char-m'),\n                                            move: transform,\n                                            width: null,\n                                        },\n                                        {\n                                            name: 'charU',\n                                            selector: document.querySelector('.logo__char-u'),\n                                            move: transform,\n                                            width: null,\n                                        },\n                                        {\n                                            name: 'squarePrimary',\n                                            selector: document.querySelector('.logo__square-primary'),\n                                            width: document.querySelector('.logo__square-primary').width.baseVal.value,\n                                        },\n                                        {\n                                            name: 'charT',\n                                            selector: document.querySelector('.logo__char-t'),\n                                            move: transform,\n                                            width: null,\n                                        },\n                                        {\n                                            name: 'charI',\n                                            selector: document.querySelector('.logo__char-i'),\n                                            move: transform,\n                                            width: null,\n                                        },\n                                        {\n                                            name: 'squareSecondary',\n                                            selector: document.querySelector('.logo__square-secondary'),\n                                            move: transform,\n                                            width: document.querySelector('.logo__square-secondary').width.baseVal.value,\n                                        },\n                                        {\n                                            name: 'charN',\n                                            selector: document.querySelector('.logo__char-n'),\n                                            move: transform,\n                                            width: null,\n                                        },\n                                        {\n                                            name: 'groupA',\n                                            selector: document.querySelector('.logo__group-a'),\n                                            move: transform,\n                                            width: null,\n                                        }\n                                    ];\n                                    tl.set(transitionLayer, {\n                                        height: window.innerHeight + 2,\n                                    });\n                                    logo.forEach(item => {\n                                        if (item.name === 'squarePrimary' || item.name === 'squareSecondary') {\n                                            tl.set(item.selector, {\n                                                width: 0,\n                                                transform: 'translateX(' + item.move + 'px)',\n                                                opacity: 1\n                                            });\n                                        } else {\n                                            tl.set(item.selector, {\n                                                transform: 'translateX(' + item.move + 'px)',\n                                                opacity: 0\n                                            });\n                                        }\n                                    });\n                                    logo.forEach((item, index) => {\n                                        let delay = '-=0.4';\n                                        if (item.name === 'squarePrimary' || item.name === 'squareSecondary') {\n                                            tl.to(item.selector, speed, {\n                                                width: item.width,\n                                                transform: 'translateX(0px)',\n                                                opacity: 1,\n                                                ease: Expo.easeInOut\n                                            }, delay);\n                                        } else {\n                                            tl.to(item.selector, speed, {\n                                                transform: 'translateX(0px)',\n                                                opacity: 1,\n                                                ease: Expo.easeInOut,\n                                                onComplete: () => {\n                                                    if (index === logo.length - 1) {\n                                                        app.onPageInit();\n                                                    }\n                                                }\n                                            }, delay);\n                                        }\n                                    });\n                                    tl.to(logoWrapper, 0.8, {\n                                        height: 0,\n                                        ease: Expo.easeInOut,\n                                    }, '+=0.5');\n                                    tl.to(transitionLayer, 1, {\n                                        height: 2,\n                                        top: app.header.clientHeight - 2,\n                                        bottom: 'auto',\n                                        ease: Expo.easeInOut,\n                                        onComplete: function () {\n                                            transitionLayer.style.height = 0;\n                                            transitionLayer.classList.add('transition--no-top-line');\n                                            done();\n                                        }\n                                    }, '-=0.6');\n                                } else {\n                                    TweenMax.set(transitionLayer, {\n                                        height: 0,\n                                        top: 0,\n                                        bottom: 'auto',\n                                    });\n                                    TweenMax.set(logoWrapper, {\n                                        height: 0,\n                                    });\n                                    app.onPageInit();\n                                    transitionLayer.classList.add('transition--no-top-line');\n                                    done();\n                                }\n                            } catch (e) {\n                                error__(e);\n                            }\n                        },\n                        /////////////////////////////////////////////\n                        beforeLeave() {\n                            LazyLoad.items = [];\n                        },\n                        leave(data) {\n                            const done = this.async();\n                            try {\n                                const title = data.trigger !== 'popstate' ? data.trigger.getAttribute('data-transition') : 'Mutina';\n                                let timeDelay = 0;\n                                if (data.trigger !== 'popstate' && data.trigger.getAttribute('data-origin') === 'panel') {\n                                    timeDelay = 300;\n                                }\n                                // setTimeout(() => {\n                                textFront.innerHTML = '';\n                                textBack.innerHTML = '';\n                                textFront.innerHTML = title;\n                                textBack.innerHTML = title;\n                                Navigation.reset();\n                                TweenMax.set(transitionLayer, {\n                                    backgroundColor: '#CFCFCF',\n                                    width: window.innerWidth,\n                                    bottom: 0,\n                                    opacity: 1,\n                                    top: 'auto',\n                                    height: 0,\n                                });\n                                TweenMax.set(textFront, {\n                                    transform: 'translateY(100%)',\n                                    opacity: 1\n                                });\n                                TweenMax.set(textBack, {\n                                    transform: 'translateY(0)',\n                                });\n                                TweenMax.set(boxBack, {\n                                    width: 0,\n                                });\n                                TweenMax.set(line, {\n                                    width: 0,\n                                });\n                                TweenMax.to(data.current.container, 1, {\n                                    transform: 'translateY(-60px)',\n                                    ease: Expo.easeInOut\n                                }).delay(0.3);\n                                TweenMax.to(transitionLayer, 1, {\n                                    height: window.innerHeight,\n                                    ease: Expo.easeInOut\n                                }).delay(0.3);\n                                TweenMax.to(textFront, 1, {\n                                    transform: 'translateY(0)',\n                                    ease: Expo.easeInOut,\n                                    onComplete: (e) => {\n                                        done();\n                                    }\n                                }).delay(0.4);\n                                // }, timeDelay);\n                            } catch (e) {\n                                error__(e);\n                            }\n                        },\n                        afterLeave(data) {\n                            const done = this.async();\n                            try {\n                                app.destroyAll(data.current.container);\n                            } catch (e) {\n                                error__(e);\n                            }\n                            done();\n                        },\n                        beforeEnter(data) {\n                            const done = this.async();\n                            try {\n                                App.initScript(data);\n                                if (breakTransition) {\n                                    throw new Error('stop!');\n                                }\n                                app.animateTransitionLine(done);\n                                app.onPageInit();\n                                /*\n                                window.daraLayer.push({})\n                                gtm.push({\n                                    title: document.title,\n                                    href: window.href\n                                })\n                                */\n                            } catch (e) {\n                                error__(e);\n                            }\n                        },\n                        enter(data) {\n                            const done = this.async();\n                            try {\n                                app.scrollTo(0, false);\n                                app.header.style.top = 0;\n                                TweenMax.to(textBack, 1, {\n                                    transform: 'translateY(-100%)',\n                                    ease: Expo.easeInOut,\n                                }).delay(0.1);\n                                TweenMax.to(textFront, 1, {\n                                    transform: 'translateY(-100%)',\n                                    ease: Expo.easeInOut,\n                                }).delay(0.1);\n                                TweenMax.to(transitionLayer, 1, {\n                                    height: 0,\n                                    top: 0,\n                                    bottom: 'auto',\n                                    ease: Expo.easeInOut,\n                                    onComplete: (e) => {\n                                        done();\n                                    }\n                                }).delay(0.3);\n                            } catch (e) {\n                                error__(e);\n                            }\n                        }\n                        ////////////////////////////////////////////////////\n                    },\n                    {\n                        name: 'fast-transition',\n                        from: {\n                            custom: ({\n                                trigger\n                            }) => {\n                                return trigger.classList && trigger.classList.contains('fast-transition');\n                            },\n                        },\n                        beforeLeave() {\n                            Dom.freezeScroll();\n                            const done = this.async();\n                            LazyLoad.items = [];\n                            done();\n                        },\n                        leave(data) {\n                            const done = this.async();\n                            //scrollPosition = document.querySelector('.page').style.transform.replace(/[^\\d.]/g, '');\n                            //debug__('SCROLLPOSITION'scrollPosition);\n                            done();\n                        },\n                        afterLeave(data) {\n                            const done = this.async();\n                            try {\n                                app.destroyAll(data.current.container);\n                            } catch (e) {\n                                error__(e);\n                            }\n                            done();\n                        },\n                        beforeEnter(data) {\n                            const done = this.async();\n                            try {\n                                App.initScript(data);\n                                app.onPageInit();\n                            } catch (e) {\n                                error__(e);\n                            }\n                            done();\n                        },\n                        enter(data) {\n                            const done = this.async();\n                            try {\n                                // set scroll height\n                                // resume scroll\n                                Dom.resumeScroll();\n                            } catch (e) {\n                                error__(e);\n                            }\n                            done();\n                        }\n                    },\n                    {\n                        name: 'fancy-in-transition',\n                        from: {\n                            custom: ({\n                                trigger\n                            }) => {\n                                return trigger.classList && trigger.classList.contains('fancy-in-transition');\n                            },\n                        },\n                        beforeLeave() {\n                            LazyLoad.items = [];\n                        },\n                        leave(data) {\n                            const done = this.async();\n                            try {\n                                Navigation.reset();\n                                //set scroll position\n                                if (Dom.fastscroll) {\n                                    scrollPosition = window.pageYOffset;\n                                } else {\n                                    scrollPosition = document.querySelector('.page').style.transform.replace(/[^\\d.]/g, '');\n                                }\n                                TweenMax.set(line, {\n                                    width: 0,\n                                });\n                                TweenMax.set(transitionLayer, {\n                                    backgroundColor: '#CFCFCF',\n                                    bottom: 0,\n                                    opacity: 1,\n                                    top: 'auto',\n                                    height: 0,\n                                });\n                                TweenMax.to(data.current.container, 1, {\n                                    transform: 'translateY(-60px)',\n                                    ease: Expo.easeInOut\n                                });\n                                TweenMax.to(transitionLayer, 1, {\n                                    height: window.innerHeight,\n                                    ease: Expo.easeInOut,\n                                });\n                                TweenMax.to(transitionLayer, 0.8, {\n                                    backgroundColor: '#ffffff',\n                                    ease: Power1.easeOut,\n                                    onComplete: (e) => {\n                                        done();\n                                    }\n                                }).delay(0.4);\n                            } catch (e) {\n                                error__(e);\n                            }\n                        },\n                        afterLeave(data) {\n                            const done = this.async();\n                            try {\n                                app.destroyAll(data.current.container);\n                            } catch (e) {\n                                error__(e);\n                            }\n                            done();\n                        },\n                        beforeEnter(data) {\n                            const done = this.async();\n                            try {\n                                App.initScript(data);\n                                app.onPageInit();\n                            } catch (e) {\n                                error__(e);\n                            }\n                            done();\n                        },\n                        enter(data) {\n                            const done = this.async();\n                            try {\n                                const sidebar = document.querySelector('.fancy-detail__sidebar');\n                                transitionLayer.style.pointerEvents = 'none';\n                                app.scrollTo(0, true);\n                                TweenMax.set(sidebar, {\n                                    left: -sidebar.clientWidth\n                                });\n                                TweenMax.to(transitionLayer, 1, {\n                                    opacity: 0,\n                                    ease: Expo.easeInOut,\n                                });\n                                TweenMax.to(sidebar, 1.5, {\n                                    left: 0,\n                                    ease: Expo.easeInOut,\n                                    onComplete: (e) => {\n                                        done();\n                                    }\n                                });\n                            } catch (e) {\n                                error__(e);\n                            }\n                        }\n                    },\n                    {\n                        name: 'fancy-out-transition',\n                        from: {\n                            custom: ({\n                                trigger\n                            }) => {\n                                return trigger.classList && trigger.classList.contains('fancy-out-transition');\n                            },\n                        },\n                        beforeLeave() {\n                            LazyLoad.items = [];\n                        },\n                        leave(data) {\n                            const done = this.async();\n                            try {\n                                const sidebar = document.querySelector('.fancy-detail__sidebar');\n                                const panel = document.querySelector('.fancy-detail__panel');\n                                transitionLayer.style.pointerEvents = 'all';\n                                if (window.innerWidth > 768) {\n                                    TweenMax.to(sidebar, 1, {\n                                        left: -sidebar.clientWidth - 10,\n                                        ease: Expo.easeInOut,\n                                    });\n                                } else {\n                                    TweenMax.to(sidebar, 1, {\n                                        opacity: 0,\n                                        transform: 'translateY(60px)',\n                                        ease: Expo.easeInOut,\n                                    });\n                                    TweenMax.to(panel, 1, {\n                                        bottom: -panel.clientHeight,\n                                        ease: Expo.easeInOut,\n                                    });\n                                }\n                                TweenMax.to(data.current.container, 1, {\n                                    opacity: 0,\n                                    transform: 'translateY(100px)',\n                                    ease: Expo.easeInOut,\n                                    onComplete: (e) => {\n                                        done();\n                                    }\n                                });\n                            } catch (e) {\n                                error__(e);\n                            }\n                        },\n                        afterLeave(data) {\n                            const done = this.async();\n                            try {\n                                TweenMax.set(transitionLayer, {\n                                    top: 'auto',\n                                    bottom: 0,\n                                    height: window.innerHeight,\n                                    backgroundColor: '#ffffff',\n                                    opacity: 1,\n                                });\n                                app.destroyAll(data.current.container);\n                            } catch (e) {\n                                error__(e);\n                            }\n                            done();\n                        },\n                        beforeEnter(data) {\n                            const done = this.async();\n                            try {\n                                App.initScript(data);\n                                app.onPageInit();\n                            } catch (e) {\n                                error__(e);\n                            }\n                            done();\n                        },\n                        enter(data) {\n                            const done = this.async();\n                            try {\n                                // scroll to scroll position\n                                setTimeout(x => {\n                                    if (Dom.fastscroll) {\n                                        app.scrollTo(scrollPosition, true);\n                                    } else {\n                                        app.scrollTo(Number(scrollPosition), true);\n                                    }\n                                    scrollPosition = 0;\n                                }, 100);\n                                TweenMax.to(transitionLayer, 1, {\n                                    height: 0,\n                                    backgroundColor: '#CFCFCF',\n                                    ease: Expo.easeInOut,\n                                    onComplete: (e) => {\n                                        done();\n                                    }\n                                });\n                            } catch (e) {\n                                error__(e);\n                            }\n                        }\n                    }\n                ],\n            });\n        } else {\n            debug__('barba disabled');\n            const transition = document.querySelector('.transition');\n            transition.remove();\n            this.onPageInit();\n        }\n    }\n\n    scrollTo(top, setHeader) {\n        window.scrollTo(0, top);\n        if (setHeader) {\n            this.header.style.top = top;\n        }\n        this.page.previousTop = top + 1;\n    }\n\n    updateViewPortHeight() {\n        if (Dom.fastscroll) {\n            let vh = window.innerHeight * 0.01;\n            if (this.vh !== vh) {\n                this.vh = vh;\n                document.documentElement.style.setProperty('--vh', `${vh}px`);\n            }\n        }\n    }\n\n    onPageInit() {\n\n        this.parallaxes = [].slice.call(document.querySelectorAll('[data-parallax]'));\n        this.pictures = [].slice.call(document.querySelectorAll('.picture img'));\n\n        this.pictures.forEach(picture => {\n            if (!picture.classList.contains('picture__secondary') && !picture.parentNode.classList.contains('picture__container')) {\n                let wrapper = document.createElement('div');\n                wrapper.classList.add('picture__container');\n                picture.parentNode.insertBefore(wrapper, picture);\n                wrapper.appendChild(picture);\n            }\n        });\n\n        this.accentsInit();\n        this.updateViewPortHeight();\n\n        LazyLoad.init();\n        Fancy.init();\n        if (Dom.fastscroll) {\n            FancyViewAll.onScroll = () => {\n                this.onScrollDidChange();\n            }; //per attivare lazyload senza smooth scroll su gallery\n        }\n        FancyViewAll.init();\n        FancyDetail.init();\n        Sliders.init();\n        Anchors.init();\n        ScrollAnchors.init();\n        Samples.onScroll = () => {\n            if (Dom.fastscroll) {\n                this.onScrollDidChange();\n            }\n        }; //per attivare lazyload senza smooth scroll su campioni\n        Samples.init();\n        Utils.toggleGrid();\n        if (typeof _products != 'undefined') {\n            Filters.init();\n        }\n        ToggleSearch.init();\n        Grid.init();\n        SidePanel.init();\n        CustomSelect.init();\n        Tabs.init();\n        Forms.init();\n        Wishlist.init();\n\n        const fancyInTransition = [...document.querySelectorAll('.fancy-in-transition img')];\n        Follower.addMouseListener(fancyInTransition);\n\n        let delay = firstLoad ? 0 : 600;\n        firstLoad = false;\n\n        setTimeout(x => {\n            this.appears = Appears.init();\n            //if (window.innerWidth > 768) {\n            window.Splitting();\n            if (document.querySelector('.cover .eyelet')) {\n                setTimeout(x => {\n                    document.querySelector('.cover .eyelet').classList.add('eyelet--loaded');\n                }, 1000)\n            }\n            //}\n            if (Dom.fastscroll) {\n                app.onScrollDidChange();\n            }\n        }, delay);\n    }\n\n    destroyAll(container) {\n        Anchors.destroyAll();\n        ScrollAnchors.destroyAll();\n        Sliders.destroyAll();\n        Fancy.destroyAll();\n        Samples.destroyAll();\n        FancyViewAll.destroyAll();\n        FancyDetail.destroyAll();\n        Filters.destroyAll();\n        ToggleSearch.destroyAll();\n        Grid.destroyAll();\n        SidePanel.destroyAll();\n        CustomSelect.destroyAll();\n        Tabs.destroyAll();\n        Forms.destroyAll();\n        Wishlist.destroyAll();\n        LazyLoad.destroyAll();\n        const fancyInTransition = [...document.querySelectorAll('.fancy-in-transition .picture img')];\n        Follower.removeMouseListener(fancyInTransition);\n\n        container.remove();\n    }\n\n    accentsInit() {\n        const coverVideo = document.querySelector('main.main--accents > .cover--video');\n        const headerWrapper = document.querySelector('.header__wrapper');\n        const video = document.querySelector('video');\n        const headerSearch = document.querySelector('.header__search input.search-btn');\n        const subnavs = [...document.querySelectorAll('.subnav')];\n        const toggle = document.querySelector('.nav__toggle-bg');\n\n        if (coverVideo) {\n            this.body.classList.add('accents-page');\n            const style = coverVideo.getAttribute('style');\n            this.header.style.cssText = style;\n            if (window.innerWidth <= 768) {\n                headerSearch.style.cssText = style;\n                headerWrapper.style.cssText = style;\n                toggle.style.cssText = style;\n            }\n\n            subnavs.forEach(x => x.style.cssText = style);\n            setTimeout(x => {\n                video.play();\n                debug__('Video cover: play');\n            }, 200);\n        } else if (this.body.classList.contains('accents-page')) {\n            this.body.classList.remove('accents-page');\n            this.header.removeAttribute('style');\n            if (window.innerWidth <= 768) {\n                headerSearch.removeAttribute('style');\n                headerWrapper.removeAttribute('style');\n                toggle.removeAttribute('style');\n            }\n            subnavs.forEach(x => x.removeAttribute('style'));\n            if (video) {\n                video.stop();\n            }\n        }\n    }\n\n    addListeners() {\n        window.addEventListener('resize', () => {\n            this.onResize();\n        });\n\n        window.addEventListener('scroll', Utils.throttle(() => {\n            this.onScroll();\n        }, 1000 / 25));\n\n        window.addEventListener('mousemove', (e) => {\n            this.onMouseMove(e);\n        });\n\n        window.addEventListener('orientationchange', (e) => {\n            this.checkDevice();\n            this.updateViewPortHeight();\n            FancyDetail.orientationChange();\n            Tabs.resetAll();\n        });\n    }\n\n    onMouseMove(e) {\n        this.mouse.x = e.clientX / window.innerWidth - 0.5;\n        this.mouse.y = e.clientY / window.innerHeight - 0.5;\n        if (this.follower.enabled) {\n            this.follower.follow(this.links.map(x => Rect.fromNode(x)));\n            this.follower.move({\n                x: e.clientX,\n                y: e.clientY\n            });\n        }\n    }\n\n    onResize() {\n        this.windowRect = this.windowRect || new Rect();\n        this.windowRect.width = window.innerWidth;\n        this.windowRect.height = window.innerHeight;\n        this.windowRect.set(this.windowRect);\n        this.checkDevice();\n        Navigation.reset(false);\n        this.updateViewPortHeight();\n    }\n\n    onScroll(e) {\n        Navigation.reset(false);\n        this.updateViewPortHeight();\n\n        // fastscroll mobile\n        const scrollTop = Dom.scrollTop();\n        if (Dom.fastscroll) {\n            const newTop = Math.round(scrollTop * 10) / 5;\n            if (this.page.previousTop !== newTop) {\n                Dom.scrolling = true;\n                if (newTop > this.page.previousTop) {\n                    this.body.classList.add('scroll-up');\n                    this.body.classList.remove('scroll-down');\n                } else {\n                    this.body.classList.remove('scroll-up');\n                    this.body.classList.add('scroll-down');\n                }\n                this.page.previousTop = newTop;\n                this.onScrollDidChange();\n            } else {\n                Dom.scrolling = false;\n            }\n        } else {\n            const diff = scrollTop - this.page.previousTop;\n            if (diff > 0) {\n                this.body.classList.add('scroll-up');\n                this.body.classList.remove('scroll-down');\n            } else {\n                this.body.classList.remove('scroll-up');\n                this.body.classList.add('scroll-down');\n            }\n        }\n\n        // header animation\n        if (this.header && !this.body.classList.contains('nav-mobile-open')) {\n            this.header.style.top = -this.header.clientHeight + 'px';\n            this.header.style.transition = 'top .15s linear';\n\n            if (this.body.classList.contains('scroll-down')) {\n                this.header.style.top = 0;\n            } else {\n                this.header.style.top = -this.header.clientHeight + 'px';\n            }\n        }\n\n        // anchorPanel animation\n        const anchorPanel = document.querySelector('.anchors');\n        if (anchorPanel) {\n            anchorPanel.style.top = -anchorPanel.clientHeight + 'px';\n            anchorPanel.style.transition = 'top .15s linear';\n            if (this.body.classList.contains('scroll-down') && scrollTop < 400) {\n                anchorPanel.style.top = -anchorPanel.clientHeight + 'px';\n            } else {\n                anchorPanel.style.top = 0;\n            }\n        }\n\n    }\n\n    checkDevice(e) {\n        if (Dom.mobile) {\n            const html = document.querySelector('html');\n            const orientation = window.orientation & 2;\n            if (orientation == 0) {\n                if (html.classList.contains('landscape')) {\n                    html.classList.remove('landscape')\n                }\n                html.classList.add('portrait')\n            } else if (orientation == 2) {\n                if (html.classList.contains('portrait')) {\n                    html.classList.remove('portrait')\n                }\n                html.classList.add('landscape')\n            }\n        }\n    }\n\n    render() {\n        // smoothscroll desktop\n        if (!Dom.fastscroll) {\n            if (this.body.offsetHeight !== this.page.offsetHeight) {\n                this.body.setAttribute('style', `height: ${this.page.offsetHeight}px;`);\n            }\n            if (!Dom.pause) {\n                const scrollTop = Dom.scrollTop();\n                let newTop = this.page.previousTop || 0;\n                newTop += (scrollTop - newTop) / scrollSpeed;\n                if (Math.abs(scrollTop - newTop) < 0.15) {\n                    newTop = scrollTop;\n                }\n                if (newTop !== undefined && !Number.isNaN(newTop) && this.page.previousTop !== newTop) {\n                    this.page.previousTop = newTop;\n                    this.page.setAttribute('style', `transform: translateY(${-newTop}px);`);\n                    Dom.scrolling = true;\n                } else {\n                    Dom.scrolling = false;\n                }\n                this.onScrollDidChange();\n            }\n\n        } else if (this.body.hasAttribute('style')) {\n            this.body.removeAttribute('style');\n            this.page.removeAttribute('style');\n        }\n\n        this.onRequestAnimDidChange();\n    }\n\n    onScrollDidChange() {\n        // appears\n        this.appears.forEach((node, i) => {\n            if (!node.to) {\n                let rect = Rect.fromNode(node);\n                const intersection = rect.intersection(this.windowRect);\n                if (intersection.y > 0.0) {\n                    node.to = setTimeout(() => {\n                        node.classList.add('appeared');\n                    }, 150 * node.appearingIndex);\n                } else {\n                    // if (node.classList.contains('appeared')) {\n                    //     node.to = null;\n                    //     node.classList.remove('appeared');\n                    // }\n                }\n            }\n        });\n        Anchors.onScroll();\n        ScrollAnchors.onScroll();\n        LazyLoad.render(this.windowRect);\n    }\n\n    onRequestAnimDidChange() {\n        if (this.follower.enabled) {\n            this.follower.render();\n        }\n    }\n\n    loop() {\n        if (!disableRender) {\n            this.render();\n            if (this.playing) {\n                window.requestAnimationFrame(() => {\n                    this.loop();\n                });\n            }\n        }\n\n    }\n\n    play() {\n        this.playing = true;\n        this.loop();\n    }\n\n    pause() {\n        this.playing = false;\n    }\n\n    polyfill() {\n        if ('NodeList' in window && !NodeList.prototype.forEach) {\n            NodeList.prototype.forEach = function (callback, thisArg) {\n                thisArg = thisArg || window;\n                for (var i = 0; i < this.length; i++) {\n                    callback.call(thisArg, this[i], i, this);\n                }\n            };\n        }\n\n        if (!('remove' in Element.prototype)) {\n            Element.prototype.remove = function () {\n                if (this.parentNode) {\n                    this.parentNode.removeChild(this);\n                }\n            };\n        }\n\n        if (typeof window.CustomEvent === \"function\") return false; //If not IE\n\n        function CustomEvent(event, params) {\n            params = params || {\n                bubbles: false,\n                cancelable: false,\n                detail: undefined\n            };\n            var evt = document.createEvent('CustomEvent');\n            evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n            return evt;\n        }\n\n        CustomEvent.prototype = window.Event.prototype;\n\n        window.CustomEvent = CustomEvent;\n    }\n\n}\n\nvar app = new App();\n\nwindow.onload = () => {\n    app.init();\n    app.play();\n};"],"file":"docs/js/app.js"}